

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Optimization of a Dissipative Quantum Gate &mdash; Krotov 506da5b documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/version-menu.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"extensions": ["tex2jax.js"], "jax": ["input/TeX", "output/SVG"], "TeX": {"extensions": ["AMSmath.js", "AMSsymbols.js"], "Macros": {"tr": ["{\\operatorname{tr}}", 0], "diag": ["{\\operatorname{diag}}", 0], "abs": ["{\\operatorname{abs}}", 0], "pop": ["{\\operatorname{pop}}", 0], "ee": ["{\\text{e}}", 0], "ii": ["{\\text{i}}", 0], "aux": ["{\\text{aux}}", 0], "opt": ["{\\text{opt}}", 0], "tgt": ["{\\text{tgt}}", 0], "init": ["{\\text{init}}", 0], "lab": ["{\\text{lab}}", 0], "rwa": ["{\\text{rwa}}", 0], "bra": ["{\\langle#1\\vert}", 1], "ket": ["{\\vert#1\\rangle}", 1], "Bra": ["{\\left\\langle#1\\right\\vert}", 1], "Braket": ["{\\left\\langle #1\\vphantom{#2} \\mid #2\\vphantom{#1}\\right\\rangle}", 2], "ketbra": ["{\\vert#1\\rangle\\!\\langle#2\\vert}", 2], "Ket": ["{\\left\\vert#1\\right\\rangle}", 1], "mat": ["{\\mathbf{#1}}", 1], "op": ["{\\hat{#1}}", 1], "Op": ["{\\hat{#1}}", 1], "dd": ["{\\,\\text{d}}", 0], "daggered": ["{^{\\dagger}}", 0], "transposed": ["{^{\\text{T}}}", 0], "Liouville": ["{\\mathcal{L}}", 0], "DynMap": ["{\\mathcal{E}}", 0], "identity": ["{\\mathbf{1}}", 0], "Norm": ["{\\lVert#1\\rVert}", 1], "Abs": ["{\\left\\vert#1\\right\\vert}", 1], "avg": ["{\\langle#1\\rangle}", 1], "Avg": ["{\\left\\langle#1\\right\\rangle}", 1], "AbsSq": ["{\\left\\vert#1\\right\\vert^2}", 1], "Re": ["{\\operatorname{Re}}", 0], "Im": ["{\\operatorname{Im}}", 0], "Real": ["{\\mathbb{R}}", 0], "Complex": ["{\\mathbb{C}}", 0], "Integer": ["{\\mathbb{N}}", 0]}}, "tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../_static/mycss.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Optimization towards a Perfect Entangler" href="07_example_PE.html" />
    <link rel="prev" title="Optimization of an X-Gate for a Transmon Qubit" href="05_example_transmon_xgate.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Krotov
          

          
          </a>

          
            
            
              <div class="version">
                0.2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../01_overview.html">Krotov Python Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02_contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04_features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05_history.html">History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06_krotovs_method.html">Krotov’s Method</a></li>
<li class="toctree-l1"><a class="reference internal" href="../07_qutip_usage.html">Using Krotov with QuTiP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../09_propagation.html">Time Propagation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../10_examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01_example_simple_state_to_state.html">Optimization of a State-to-State Transfer in a Two-Level-System</a></li>
<li class="toctree-l2"><a class="reference internal" href="02_example_lambda_system_rwa_complex_pulse.html">Optimization of a state-to-state transfer in a lambda system with RWA</a></li>
<li class="toctree-l2"><a class="reference internal" href="03_example_lambda_system_rwa_non_hermitian.html">Optimization of a dissipative state-to-state transfer in a Lambda system</a></li>
<li class="toctree-l2"><a class="reference internal" href="04_example_dissipative_qubit_reset.html">Optimization of Dissipative Qubit Reset</a></li>
<li class="toctree-l2"><a class="reference internal" href="05_example_transmon_xgate.html">Optimization of an X-Gate for a Transmon Qubit</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Optimization of a Dissipative Quantum Gate</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#The-two-transmon-system">The two-transmon system</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Optimization-objectives">Optimization objectives</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Dynamics-under-the-Guess-Pulse">Dynamics under the Guess Pulse</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Optimization">Optimization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Optimization-result">Optimization result</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="07_example_PE.html">Optimization towards a Perfect Entangler</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../11_howto.html">How-Tos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../12_other_methods.html">Other Optimization Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../99_bibliography.html">References</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../API/krotov.html">API of the Krotov package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Krotov</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          





















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../10_examples.html">Examples</a> &raquo;</li>
        
      <li>Optimization of a Dissipative Quantum Gate</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 5ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<p><span class="raw-html"><a href="http://nbviewer.jupyter.org/github/qucontrol/krotov/blob/506da5b/docs/notebooks/06_example_3states.ipynb" target="_blank"><img alt="Render on nbviewer" src="https://img.shields.io/badge/render%20on-nbviewer-orange.svg" style="vertical-align:text-bottom"></a>&nbsp;<a href="https://mybinder.org/v2/gh/qucontrol/krotov/506da5b?filepath=docs/notebooks/06_example_3states.ipynb" target="_blank"><img alt="Launch Binder" src="https://mybinder.org/badge_logo.svg" style="vertical-align:text-bottom"></a></span></p>
<div class="section" id="Optimization-of-a-Dissipative-Quantum-Gate">
<h1>Optimization of a Dissipative Quantum Gate<a class="headerlink" href="#Optimization-of-a-Dissipative-Quantum-Gate" title="Permalink to this headline">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># NBVAL_IGNORE_OUTPUT</span>
<span class="o">%</span><span class="k">load_ext</span> watermark
<span class="kn">import</span> <span class="nn">qutip</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">krotov</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>
<span class="o">%</span><span class="k">watermark</span> -v --iversions
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
matplotlib.pylab 1.15.4
scipy            1.2.0
qutip            4.3.1
numpy            1.15.4
matplotlib       3.0.2
krotov           0.1.0.post1+dev
CPython 3.6.8
IPython 7.2.0
</pre></div></div>
</div>
<p><span class="math notranslate nohighlight">\(\newcommand{tr}[0]{\operatorname{tr}} \newcommand{diag}[0]{\operatorname{diag}} \newcommand{abs}[0]{\operatorname{abs}} \newcommand{pop}[0]{\operatorname{pop}} \newcommand{aux}[0]{\text{aux}} \newcommand{int}[0]{\text{int}} \newcommand{opt}[0]{\text{opt}} \newcommand{tgt}[0]{\text{tgt}} \newcommand{init}[0]{\text{init}} \newcommand{lab}[0]{\text{lab}} \newcommand{rwa}[0]{\text{rwa}} \newcommand{bra}[1]{\langle#1\vert} \newcommand{ket}[1]{\vert#1\rangle} \newcommand{Bra}[1]{\left\langle#1\right\vert} \newcommand{Ket}[1]{\left\vert#1\right\rangle} \newcommand{Braket}[2]{\left\langle #1\vphantom{#2} \mid #2\vphantom{#1}\right\rangle} \newcommand{ketbra}[2]{\vert#1\rangle\!\langle#2\vert} \newcommand{op}[1]{\hat{#1}} \newcommand{Op}[1]{\hat{#1}} \newcommand{dd}[0]{\,\text{d}} \newcommand{Liouville}[0]{\mathcal{L}} \newcommand{DynMap}[0]{\mathcal{E}} \newcommand{identity}[0]{\mathbf{1}} \newcommand{Norm}[1]{\lVert#1\rVert} \newcommand{Abs}[1]{\left\vert#1\right\vert} \newcommand{avg}[1]{\langle#1\rangle} \newcommand{Avg}[1]{\left\langle#1\right\rangle} \newcommand{AbsSq}[1]{\left\vert#1\right\vert^2} \newcommand{Re}[0]{\operatorname{Re}} \newcommand{Im}[0]{\operatorname{Im}}\)</span></p>
<p>This example illustrates the optimization for a quantum gate in an open quantum system, where the dynamics is governed by the Liouville-von Neumann equation. A naive extension of a gate optimization to Liouville space would seem to imply that it is necessary to optimize over the full basis of Liouville space (16 matrices, for a two-qubit gate). However, Goerz et al., New J. Phys. 16, 055012 (2014) [<a class="reference external" href="https://michaelgoerz.net/research/Goerz_NJP2014.pdf">GoerzNJP2014</a>] showed that is not
necessary, but that a set of 3 density matrices is sufficient to track the optimization.</p>
<p>This example reproduces the “Example II” from that paper, considering the optimization towards a <span class="math notranslate nohighlight">\(\sqrt{\text{iSWAP}}\)</span> two-qubit gate on a system of two transmons with a shared transmission line resonator.</p>
<div class="section" id="The-two-transmon-system">
<h2>The two-transmon system<a class="headerlink" href="#The-two-transmon-system" title="Permalink to this headline">¶</a></h2>
<p>We consider the Hamiltonian from Eq (17) in [GoerzNJP2014], in the rotating wave approximation, together with spontaneous decay and dephasing of each qubit. Alltogether, we define the Liouvillian as follows:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">two_qubit_transmon_liouvillian</span><span class="p">(</span>
    <span class="n">ω1</span><span class="p">,</span> <span class="n">ω2</span><span class="p">,</span> <span class="n">ωd</span><span class="p">,</span> <span class="n">δ1</span><span class="p">,</span> <span class="n">δ2</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">q1T1</span><span class="p">,</span> <span class="n">q2T1</span><span class="p">,</span> <span class="n">q1T2</span><span class="p">,</span> <span class="n">q2T2</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Omega</span><span class="p">,</span> <span class="n">n_qubit</span>
<span class="p">):</span>
    <span class="kn">from</span> <span class="nn">qutip</span> <span class="kn">import</span> <span class="n">tensor</span><span class="p">,</span> <span class="n">identity</span><span class="p">,</span> <span class="n">destroy</span>

    <span class="n">b1</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">identity</span><span class="p">(</span><span class="n">n_qubit</span><span class="p">),</span> <span class="n">destroy</span><span class="p">(</span><span class="n">n_qubit</span><span class="p">))</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">destroy</span><span class="p">(</span><span class="n">n_qubit</span><span class="p">),</span> <span class="n">identity</span><span class="p">(</span><span class="n">n_qubit</span><span class="p">))</span>

    <span class="n">H0</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">ω1</span> <span class="o">-</span> <span class="n">ωd</span> <span class="o">-</span> <span class="n">δ1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">b1</span><span class="o">.</span><span class="n">dag</span><span class="p">()</span> <span class="o">*</span> <span class="n">b1</span>
        <span class="o">+</span> <span class="p">(</span><span class="n">δ1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">b1</span><span class="o">.</span><span class="n">dag</span><span class="p">()</span> <span class="o">*</span> <span class="n">b1</span> <span class="o">*</span> <span class="n">b1</span><span class="o">.</span><span class="n">dag</span><span class="p">()</span> <span class="o">*</span> <span class="n">b1</span>
        <span class="o">+</span> <span class="p">(</span><span class="n">ω2</span> <span class="o">-</span> <span class="n">ωd</span> <span class="o">-</span> <span class="n">δ2</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">b2</span><span class="o">.</span><span class="n">dag</span><span class="p">()</span> <span class="o">*</span> <span class="n">b2</span>
        <span class="o">+</span> <span class="p">(</span><span class="n">δ2</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">b2</span><span class="o">.</span><span class="n">dag</span><span class="p">()</span> <span class="o">*</span> <span class="n">b2</span> <span class="o">*</span> <span class="n">b2</span><span class="o">.</span><span class="n">dag</span><span class="p">()</span> <span class="o">*</span> <span class="n">b2</span>
        <span class="o">+</span> <span class="n">J</span> <span class="o">*</span> <span class="p">(</span><span class="n">b1</span><span class="o">.</span><span class="n">dag</span><span class="p">()</span> <span class="o">*</span> <span class="n">b2</span> <span class="o">+</span> <span class="n">b1</span> <span class="o">*</span> <span class="n">b2</span><span class="o">.</span><span class="n">dag</span><span class="p">())</span>
    <span class="p">)</span>

    <span class="n">H1_re</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">b1</span> <span class="o">+</span> <span class="n">b1</span><span class="o">.</span><span class="n">dag</span><span class="p">()</span> <span class="o">+</span> <span class="n">b2</span> <span class="o">+</span> <span class="n">b2</span><span class="o">.</span><span class="n">dag</span><span class="p">())</span>
    <span class="n">H1_im</span> <span class="o">=</span> <span class="mf">0.5</span><span class="n">j</span> <span class="o">*</span> <span class="p">(</span><span class="n">b1</span> <span class="o">-</span> <span class="n">b1</span><span class="o">.</span><span class="n">dag</span><span class="p">()</span> <span class="o">+</span> <span class="n">b2</span> <span class="o">-</span> <span class="n">b2</span><span class="o">.</span><span class="n">dag</span><span class="p">())</span>

    <span class="n">H</span> <span class="o">=</span> <span class="p">[</span><span class="n">H0</span><span class="p">,</span> <span class="p">[</span><span class="n">H1_re</span><span class="p">,</span> <span class="n">Omega</span><span class="p">],</span> <span class="p">[</span><span class="n">H1_im</span><span class="p">,</span> <span class="n">ZeroPulse</span><span class="p">]]</span>

    <span class="n">A1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">q1T1</span><span class="p">)</span> <span class="o">*</span> <span class="n">b1</span>  <span class="c1"># decay of qubit 1</span>
    <span class="n">A2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">q2T1</span><span class="p">)</span> <span class="o">*</span> <span class="n">b2</span>  <span class="c1"># decay of qubit 2</span>
    <span class="n">A3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">q1T2</span><span class="p">)</span> <span class="o">*</span> <span class="n">b1</span><span class="o">.</span><span class="n">dag</span><span class="p">()</span> <span class="o">*</span> <span class="n">b1</span>  <span class="c1"># dephasing of qubit 1</span>
    <span class="n">A4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">q2T2</span><span class="p">)</span> <span class="o">*</span> <span class="n">b2</span><span class="o">.</span><span class="n">dag</span><span class="p">()</span> <span class="o">*</span> <span class="n">b2</span>  <span class="c1"># dephasing of qubit 2</span>

    <span class="n">L</span> <span class="o">=</span> <span class="n">krotov</span><span class="o">.</span><span class="n">objectives</span><span class="o">.</span><span class="n">liouvillian</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">c_ops</span><span class="o">=</span><span class="p">[</span><span class="n">A1</span><span class="p">,</span> <span class="n">A2</span><span class="p">,</span> <span class="n">A3</span><span class="p">,</span> <span class="n">A4</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">L</span>
</pre></div>
</div>
</div>
<p>We will use internal units GHz and ns. Values in GHz contain an implicit factor 2π, and MHz and μs are converted to GHz and ns, respectively:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">GHz</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">MHz</span> <span class="o">=</span> <span class="mf">1e-3</span> <span class="o">*</span> <span class="n">GHz</span>
<span class="n">ns</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">μs</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">*</span> <span class="n">ns</span>
</pre></div>
</div>
</div>
<p>We will use the same parameters as those given in Table 2 of [GoerzNJP2014]:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ω1</span> <span class="o">=</span> <span class="mf">4.3796</span> <span class="o">*</span> <span class="n">GHz</span>  <span class="c1"># qubit frequency 1</span>
<span class="n">ω2</span> <span class="o">=</span> <span class="mf">4.6137</span> <span class="o">*</span> <span class="n">GHz</span>  <span class="c1"># qubit frequency 2</span>
<span class="n">ωd</span> <span class="o">=</span> <span class="mf">4.4985</span> <span class="o">*</span> <span class="n">GHz</span>  <span class="c1"># drive frequency</span>
<span class="n">δ1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">239.3</span> <span class="o">*</span> <span class="n">MHz</span>  <span class="c1"># anharmonicity 1</span>
<span class="n">δ2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">242.8</span> <span class="o">*</span> <span class="n">MHz</span>  <span class="c1"># anharmonicity 2</span>
<span class="n">J</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.3</span> <span class="o">*</span> <span class="n">MHz</span>     <span class="c1"># effective qubit-qubit coupling</span>
<span class="n">q1T1</span> <span class="o">=</span> <span class="mf">38.0</span> <span class="o">*</span> <span class="n">μs</span>   <span class="c1"># decay time for qubit 1</span>
<span class="n">q2T1</span> <span class="o">=</span> <span class="mf">32.0</span> <span class="o">*</span> <span class="n">μs</span>   <span class="c1"># decay time for qubit 2</span>
<span class="n">q1T2</span> <span class="o">=</span> <span class="mf">29.5</span> <span class="o">*</span> <span class="n">μs</span>   <span class="c1"># dephasing time for qubit 1</span>
<span class="n">q2T2</span> <span class="o">=</span> <span class="mf">16.0</span> <span class="o">*</span> <span class="n">μs</span>   <span class="c1"># dephasing time for qubit 2</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">400</span> <span class="o">*</span> <span class="n">ns</span>       <span class="c1"># gate duration</span>
<span class="n">n_qubit</span> <span class="o">=</span> <span class="mi">6</span>        <span class="c1"># number of transmon levels to consider</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">tlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>In the Liouvillian, note the control being split up into a separate real and imaginary part. As a guess control we use a real-valued constant pulse with and amplitude of 35 MHz, acting over 400 ns, with a switch-on and switch-off in the first 20 ns (see plot below)</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">Omega</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="n">E0</span> <span class="o">=</span> <span class="mf">35.0</span> <span class="o">*</span> <span class="n">MHz</span>
    <span class="k">return</span> <span class="n">E0</span> <span class="o">*</span> <span class="n">krotov</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">flattop</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">t_rise</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="n">ns</span><span class="p">),</span> <span class="n">func</span><span class="o">=</span><span class="s1">&#39;sinsq&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The imaginary part start out as zero:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">ZeroPulse</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">0.0</span>
</pre></div>
</div>
</div>
<p>We can now instantiate the Liouvillian:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">L</span> <span class="o">=</span> <span class="n">two_qubit_transmon_liouvillian</span><span class="p">(</span>
    <span class="n">ω1</span><span class="p">,</span> <span class="n">ω2</span><span class="p">,</span> <span class="n">ωd</span><span class="p">,</span> <span class="n">δ1</span><span class="p">,</span> <span class="n">δ2</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">q1T1</span><span class="p">,</span> <span class="n">q2T1</span><span class="p">,</span> <span class="n">q1T2</span><span class="p">,</span> <span class="n">q2T2</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Omega</span><span class="p">,</span> <span class="n">n_qubit</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>The guess pulse looks as follows:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">plot_pulse</span><span class="p">(</span><span class="n">pulse</span><span class="p">,</span> <span class="n">tlist</span><span class="p">,</span> <span class="n">xlimit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">pulse</span><span class="p">):</span>
        <span class="n">pulse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pulse</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tlist</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tlist</span><span class="p">,</span> <span class="n">pulse</span><span class="o">/</span><span class="n">MHz</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time (ns)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;pulse amplitude (MHz)&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xlimit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlimit</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_pulse</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">tlist</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_06_example_3states_19_0.png" src="../_images/notebooks_06_example_3states_19_0.png" />
</div>
</div>
</div>
<div class="section" id="Optimization-objectives">
<h2>Optimization objectives<a class="headerlink" href="#Optimization-objectives" title="Permalink to this headline">¶</a></h2>
<p>Our target gate is <span class="math notranslate nohighlight">\(\sqrt{\text{iSWAP}}\)</span>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">gate</span> <span class="o">=</span> <span class="n">qutip</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">sqrtiswap</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">gate</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="math notranslate nohighlight">
Quantum object: dims = [[2, 2], [2, 2]], shape = (4, 4), type = oper, isherm = False\begin{equation*}\left(\begin{array}{*{11}c}1.0 &amp; 0.0 &amp; 0.0 &amp; 0.0\\0.0 &amp; 0.707 &amp; 0.707j &amp; 0.0\\0.0 &amp; 0.707j &amp; 0.707 &amp; 0.0\\0.0 &amp; 0.0 &amp; 0.0 &amp; 1.0\\\end{array}\right)\end{equation*}</div></div>
</div>
<p>The key idea explored in [GoerzNJP2014] is that a set of three density matrices is sufficient to track the optimization</p>
<p>:nbsphinx-math:<a href="#id1"><span class="problematic" id="id2">`</span></a>begin{align}
Op{rho}_1 &amp;= sum_{i=1}^{d}</p>
<blockquote>
<div><blockquote>
<div>frac{2 (d-i+1)}{d (d+1)} ketbra{i}{i} \</div></blockquote>
<dl class="docutils">
<dt>Op{rho}_2 &amp;= sum_{i,j=1}^{d}</dt>
<dd>frac{1}{d} ketbra{i}{j} \</dd>
<dt>Op{rho}_3 &amp;= sum_{i=1}^{d}</dt>
<dd>frac{1}{d} ketbra{i}{i}</dd>
</dl>
</div></blockquote>
<p>end{align}`</p>
<p>In our case, <span class="math notranslate nohighlight">\(d=4\)</span> for a two qubit-gate, and the <span class="math notranslate nohighlight">\(\ket{i}\)</span>, <span class="math notranslate nohighlight">\(\ket{j}\)</span> are the canonical basis states <span class="math notranslate nohighlight">\(\ket{00}\)</span>, <span class="math notranslate nohighlight">\(\ket{01}\)</span>, <span class="math notranslate nohighlight">\(\ket{10}\)</span>, <span class="math notranslate nohighlight">\(\ket{11}\)</span></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ket00</span> <span class="o">=</span> <span class="n">qutip</span><span class="o">.</span><span class="n">ket</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="p">(</span><span class="n">n_qubit</span><span class="p">,</span> <span class="n">n_qubit</span><span class="p">))</span>
<span class="n">ket01</span> <span class="o">=</span> <span class="n">qutip</span><span class="o">.</span><span class="n">ket</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="p">(</span><span class="n">n_qubit</span><span class="p">,</span> <span class="n">n_qubit</span><span class="p">))</span>
<span class="n">ket10</span> <span class="o">=</span> <span class="n">qutip</span><span class="o">.</span><span class="n">ket</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="p">(</span><span class="n">n_qubit</span><span class="p">,</span> <span class="n">n_qubit</span><span class="p">))</span>
<span class="n">ket11</span> <span class="o">=</span> <span class="n">qutip</span><span class="o">.</span><span class="n">ket</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="p">(</span><span class="n">n_qubit</span><span class="p">,</span> <span class="n">n_qubit</span><span class="p">))</span>
<span class="n">basis</span> <span class="o">=</span> <span class="p">[</span><span class="n">ket00</span><span class="p">,</span> <span class="n">ket01</span><span class="p">,</span> <span class="n">ket10</span><span class="p">,</span> <span class="n">ket11</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>The three density matrices play different roles in the optimization, and, as shown in [GoerzNJP2014], convergence may improve significantly by weighing the states relatively to each other. For this example, we place a strong emphasis on the optimization <span class="math notranslate nohighlight">\(\Op{\rho}_1 \rightarrow \Op{O}^\dagger \Op{\rho}_1 \Op{O}\)</span>, by a factor of 20. This reflects that the hardest part of the optimization is identifying the basis in which the gate is diagonal.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">krotov.gate_objectives</span></code> routine can initialize the density matrices <span class="math notranslate nohighlight">\(\Op{\rho}_1\)</span>, <span class="math notranslate nohighlight">\(\Op{\rho}_2\)</span>, <span class="math notranslate nohighlight">\(\Op{\rho}_3\)</span> automatically, via the parameter <code class="docutils literal notranslate"><span class="pre">liouville_states_set</span></code>. Alternatively, we could also use the <code class="docutils literal notranslate"><span class="pre">'full'</span></code> basis of 16 matrices or the extended set of <span class="math notranslate nohighlight">\(d+1 = 5\)</span> pure-state density matrices.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">objectives</span> <span class="o">=</span> <span class="n">krotov</span><span class="o">.</span><span class="n">gate_objectives</span><span class="p">(</span><span class="n">basis</span><span class="p">,</span> <span class="n">gate</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">liouville_states_set</span><span class="o">=</span><span class="s1">&#39;3states&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The weights are automatically normalized and stored in the <code class="docutils literal notranslate"><span class="pre">weight</span></code> attribute of the three objectives:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objectives</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.5f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">obj</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2.72727
0.13636
0.13636
</pre></div></div>
</div>
</div>
<div class="section" id="Dynamics-under-the-Guess-Pulse">
<h2>Dynamics under the Guess Pulse<a class="headerlink" href="#Dynamics-under-the-Guess-Pulse" title="Permalink to this headline">¶</a></h2>
<p>For numerical efficiency, both for the analysis of the guess/optimized controls, we will use a stateful density matrix propagator:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">propagator</span> <span class="o">=</span> <span class="n">krotov</span><span class="o">.</span><span class="n">propagators</span><span class="o">.</span><span class="n">DensityMatrixODEPropagator</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>A true physical measure for the success of the optimization is the “average gate fidelity”. Evaluating the fidelity requires to simulate the dynamics of the full basis of Liouville space:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">full_liouville_basis</span> <span class="o">=</span> <span class="p">[</span><span class="n">psi</span> <span class="o">*</span> <span class="n">phi</span><span class="o">.</span><span class="n">dag</span><span class="p">()</span> <span class="k">for</span> <span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">basis</span><span class="p">,</span> <span class="n">basis</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<p>We propagate these under the guess control:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">propagate_guess</span><span class="p">(</span><span class="n">initial_state</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">objectives</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">propagate</span><span class="p">(</span>
        <span class="n">tlist</span><span class="p">,</span>
        <span class="n">propagator</span><span class="o">=</span><span class="n">propagator</span><span class="p">,</span>
        <span class="n">rho0</span><span class="o">=</span><span class="n">initial_state</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">full_states_T</span> <span class="o">=</span> <span class="n">qutip</span><span class="o">.</span><span class="n">parallel_map</span><span class="p">(</span>
    <span class="n">propagate_guess</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">full_liouville_basis</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;F_avg = </span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">krotov</span><span class="o">.</span><span class="n">functionals</span><span class="o">.</span><span class="n">F_avg</span><span class="p">(</span><span class="n">full_states_T</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">gate</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
F_avg = 0.344
</pre></div></div>
</div>
<p>We can also consider the population dynamics, under the guess pulse. For this purpose we propagate the pure-state density matrices corresponding to the canonical logical basis in Hilbert space, and obtain the expectation values for the projection onto these same states:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rho00</span><span class="p">,</span> <span class="n">rho01</span><span class="p">,</span> <span class="n">rho10</span><span class="p">,</span> <span class="n">rho11</span> <span class="o">=</span> <span class="p">[</span><span class="n">qutip</span><span class="o">.</span><span class="n">ket2dm</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span> <span class="k">for</span> <span class="n">psi</span> <span class="ow">in</span> <span class="n">basis</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">propagate_guess_for_expvals</span><span class="p">(</span><span class="n">initial_state</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">objectives</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">propagate</span><span class="p">(</span>
        <span class="n">tlist</span><span class="p">,</span>
        <span class="n">propagator</span><span class="o">=</span><span class="n">propagator</span><span class="p">,</span>
        <span class="n">rho0</span><span class="o">=</span><span class="n">initial_state</span><span class="p">,</span>
        <span class="n">e_ops</span><span class="o">=</span><span class="p">[</span><span class="n">rho00</span><span class="p">,</span> <span class="n">rho01</span><span class="p">,</span> <span class="n">rho10</span><span class="p">,</span> <span class="n">rho11</span><span class="p">]</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">plot_population_dynamics</span><span class="p">(</span><span class="n">dyn00</span><span class="p">,</span> <span class="n">dyn01</span><span class="p">,</span> <span class="n">dyn10</span><span class="p">,</span> <span class="n">dyn11</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">axs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">axs</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;00&#39;</span><span class="p">,</span> <span class="s1">&#39;01&#39;</span><span class="p">,</span> <span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;11&#39;</span><span class="p">]</span>
    <span class="n">dyns</span> <span class="o">=</span> <span class="p">[</span><span class="n">dyn00</span><span class="p">,</span> <span class="n">dyn01</span><span class="p">,</span> <span class="n">dyn10</span><span class="p">,</span> <span class="n">dyn11</span><span class="p">]</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">dyn</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">dyns</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dyn</span><span class="o">.</span><span class="n">times</span><span class="p">,</span> <span class="n">dyn</span><span class="o">.</span><span class="n">expect</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_population_dynamics</span><span class="p">(</span>
    <span class="o">*</span><span class="n">qutip</span><span class="o">.</span><span class="n">parallel_map</span><span class="p">(</span>
        <span class="n">propagate_guess_for_expvals</span><span class="p">,</span>
        <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="n">rho00</span><span class="p">,</span> <span class="n">rho01</span><span class="p">,</span> <span class="n">rho10</span><span class="p">,</span> <span class="n">rho11</span><span class="p">],</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_06_example_3states_46_0.png" src="../_images/notebooks_06_example_3states_46_0.png" />
</div>
</div>
</div>
<div class="section" id="Optimization">
<h2>Optimization<a class="headerlink" href="#Optimization" title="Permalink to this headline">¶</a></h2>
<p>Before running the optimizaton, we have to define the optimization parameters for the controls, the Krotov step size <span class="math notranslate nohighlight">\(\lambda_a\)</span> and the update-shape that will ensure that the pulse switch-on and switch-off stays intact.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pulse_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">lambda_a</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">shape</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span>
            <span class="n">krotov</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">flattop</span><span class="p">,</span> <span class="n">t_start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t_stop</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">t_rise</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="n">ns</span><span class="p">))</span>
        <span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="n">ch</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
<span class="n">ch</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2">:</span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">ch</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">handlers</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">print_error</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">):</span>
    <span class="n">J_T_hs</span> <span class="o">=</span> <span class="n">krotov</span><span class="o">.</span><span class="n">functionals</span><span class="o">.</span><span class="n">J_T_hs</span><span class="p">(</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;fw_states_T&#39;</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;objectives&#39;</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;tau_vals&#39;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Iteration </span><span class="si">%d</span><span class="s2">: </span><span class="se">\t</span><span class="s2">J_T_hs = </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;iteration&#39;</span><span class="p">],</span> <span class="n">J_T_hs</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">J_T_hs</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># NBVAL_SKIP</span>
<span class="n">oct_result</span> <span class="o">=</span> <span class="n">krotov</span><span class="o">.</span><span class="n">optimize_pulses</span><span class="p">(</span>
    <span class="n">objectives</span><span class="p">,</span>
    <span class="n">pulse_options</span><span class="p">,</span>
    <span class="n">tlist</span><span class="p">,</span>
    <span class="n">propagator</span><span class="o">=</span><span class="n">propagator</span><span class="p">,</span>
    <span class="n">chi_constructor</span><span class="o">=</span><span class="n">krotov</span><span class="o">.</span><span class="n">functionals</span><span class="o">.</span><span class="n">chis_hs</span><span class="p">,</span>
    <span class="n">info_hook</span><span class="o">=</span><span class="n">print_error</span><span class="p">,</span>
    <span class="n">iter_stop</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="c1">#parallel_map=(</span>
    <span class="c1">#    qutip.parallel_map,</span>
    <span class="c1">#    qutip.parallel_map,</span>
    <span class="c1">#    krotov.parallelization.parallel_map_fw_prop_step,</span>
    <span class="c1">#),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2019-02-11 02:03:26,073:Initializing optimization with Krotov&#39;s method
2019-02-11 02:03:26,112:Started initial forward propagation of objective 0
2019-02-11 02:03:40,671:Finished initial forward propagation of objective 0
2019-02-11 02:03:40,672:Started initial forward propagation of objective 1
2019-02-11 02:03:52,199:Finished initial forward propagation of objective 1
2019-02-11 02:03:52,199:Started initial forward propagation of objective 2
2019-02-11 02:04:04,405:Finished initial forward propagation of objective 2
2019-02-11 02:04:04,408:Started Krotov iteration 1
2019-02-11 02:04:04,415:Started backward propagation of state 0
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Iteration 0:    J_T_hs = 0.063449
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2019-02-11 02:04:12,823:Finished backward propagation of state 0
2019-02-11 02:04:12,824:Started backward propagation of state 1
2019-02-11 02:04:21,094:Finished backward propagation of state 1
2019-02-11 02:04:21,095:Started backward propagation of state 2
2019-02-11 02:04:30,908:Finished backward propagation of state 2
2019-02-11 02:04:30,909:Started forward propagation/pulse update
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">IntegratorConcurrencyError</span>                Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-29-f13f2354e6c9&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      7</span>     chi_constructor<span class="ansi-blue-fg">=</span>krotov<span class="ansi-blue-fg">.</span>functionals<span class="ansi-blue-fg">.</span>chis_hs<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">      8</span>     info_hook<span class="ansi-blue-fg">=</span>print_error<span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">----&gt; 9</span><span class="ansi-red-fg">     </span>iter_stop<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">5</span><span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">     10</span>     <span class="ansi-red-fg">#parallel_map=(</span>
<span class="ansi-green-intense-fg ansi-bold">     11</span>     <span class="ansi-red-fg">#    qutip.parallel_map,</span>

<span class="ansi-green-fg">~/Documents/Programming/github/krotov/src/krotov/optimize.py</span> in <span class="ansi-cyan-fg">optimize_pulses</span><span class="ansi-blue-fg">(objectives, pulse_options, tlist, propagator, chi_constructor, mu, sigma, iter_start, iter_stop, check_convergence, state_dependent_constraint, info_hook, modify_params_after_iter, storage, parallel_map, store_all_pulses)</span>
<span class="ansi-green-intense-fg ansi-bold">    349</span>                     tlist<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    350</span>                     time_index<span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">--&gt; 351</span><span class="ansi-red-fg">                     </span>propagators<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    352</span>                 ),
<span class="ansi-green-intense-fg ansi-bold">    353</span>             )

<span class="ansi-green-fg">~/Documents/Programming/github/krotov/.venv/py36/lib/python3.6/site-packages/qutip/parallel.py</span> in <span class="ansi-cyan-fg">serial_map</span><span class="ansi-blue-fg">(task, values, task_args, task_kwargs, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    181</span>     <span class="ansi-green-fg">for</span> n<span class="ansi-blue-fg">,</span> value <span class="ansi-green-fg">in</span> enumerate<span class="ansi-blue-fg">(</span>values<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    182</span>         progress_bar<span class="ansi-blue-fg">.</span>update<span class="ansi-blue-fg">(</span>n<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 183</span><span class="ansi-red-fg">         </span>result <span class="ansi-blue-fg">=</span> task<span class="ansi-blue-fg">(</span>value<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>task_args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>task_kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    184</span>         results<span class="ansi-blue-fg">.</span>append<span class="ansi-blue-fg">(</span>result<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    185</span>     progress_bar<span class="ansi-blue-fg">.</span>finished<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/Documents/Programming/github/krotov/src/krotov/optimize.py</span> in <span class="ansi-cyan-fg">_forward_propagation_step</span><span class="ansi-blue-fg">(i_state, states, objectives, pulses, pulses_mapping, tlist, time_index, propagators)</span>
<span class="ansi-green-intense-fg ansi-bold">    623</span>     dt <span class="ansi-blue-fg">=</span> tlist<span class="ansi-blue-fg">[</span>time_index <span class="ansi-blue-fg">+</span> <span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">-</span> tlist<span class="ansi-blue-fg">[</span>time_index<span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">    624</span>     return propagators[i_state](
<span class="ansi-green-fg">--&gt; 625</span><span class="ansi-red-fg">         </span>H<span class="ansi-blue-fg">,</span> state<span class="ansi-blue-fg">,</span> dt<span class="ansi-blue-fg">,</span> c_ops<span class="ansi-blue-fg">,</span> initialize<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">(</span>time_index <span class="ansi-blue-fg">==</span> <span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    626</span>     )

<span class="ansi-green-fg">~/Documents/Programming/github/krotov/src/krotov/propagators.py</span> in <span class="ansi-cyan-fg">__call__</span><span class="ansi-blue-fg">(self, L, rho, dt, c_ops, backwards, initialize)</span>
<span class="ansi-green-intense-fg ansi-bold">    152</span>                 self<span class="ansi-blue-fg">.</span>_L_list<span class="ansi-blue-fg">[</span>i<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">=</span> L<span class="ansi-blue-fg">[</span>i<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">    153</span>         self<span class="ansi-blue-fg">.</span>_t <span class="ansi-blue-fg">+=</span> dt
<span class="ansi-green-fg">--&gt; 154</span><span class="ansi-red-fg">         </span>self<span class="ansi-blue-fg">.</span>_r<span class="ansi-blue-fg">.</span>integrate<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>_t<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    155</span>         return qutip.Qobj(
<span class="ansi-green-intense-fg ansi-bold">    156</span>             dense2D_to_fastcsr_fmode(

<span class="ansi-green-fg">~/Documents/Programming/github/krotov/.venv/py36/lib/python3.6/site-packages/scipy/integrate/_ode.py</span> in <span class="ansi-cyan-fg">integrate</span><span class="ansi-blue-fg">(self, t, step, relax)</span>
<span class="ansi-green-intense-fg ansi-bold">    430</span>             self._y, self.t = mth(self.f, self.jac or (lambda: None),
<span class="ansi-green-intense-fg ansi-bold">    431</span>                                   self<span class="ansi-blue-fg">.</span>_y<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>t<span class="ansi-blue-fg">,</span> t<span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">--&gt; 432</span><span class="ansi-red-fg">                                   self.f_params, self.jac_params)
</span><span class="ansi-green-intense-fg ansi-bold">    433</span>         <span class="ansi-green-fg">except</span> SystemError<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    434</span>             <span class="ansi-red-fg"># f2py issue with tuple returns, see ticket 1187.</span>

<span class="ansi-green-fg">~/Documents/Programming/github/krotov/.venv/py36/lib/python3.6/site-packages/scipy/integrate/_ode.py</span> in <span class="ansi-cyan-fg">run</span><span class="ansi-blue-fg">(self, f, jac, y0, t0, t1, f_params, jac_params)</span>
<span class="ansi-green-intense-fg ansi-bold">    989</span>     <span class="ansi-green-fg">def</span> run<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> f<span class="ansi-blue-fg">,</span> jac<span class="ansi-blue-fg">,</span> y0<span class="ansi-blue-fg">,</span> t0<span class="ansi-blue-fg">,</span> t1<span class="ansi-blue-fg">,</span> f_params<span class="ansi-blue-fg">,</span> jac_params<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    990</span>         <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>initialized<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 991</span><span class="ansi-red-fg">             </span>self<span class="ansi-blue-fg">.</span>check_handle<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    992</span>         <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    993</span>             self<span class="ansi-blue-fg">.</span>initialized <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">True</span>

<span class="ansi-green-fg">~/Documents/Programming/github/krotov/.venv/py36/lib/python3.6/site-packages/scipy/integrate/_ode.py</span> in <span class="ansi-cyan-fg">check_handle</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    789</span>     <span class="ansi-green-fg">def</span> check_handle<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    790</span>         <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>handle <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> self<span class="ansi-blue-fg">.</span>__class__<span class="ansi-blue-fg">.</span>active_global_handle<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 791</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">raise</span> IntegratorConcurrencyError<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>__class__<span class="ansi-blue-fg">.</span>__name__<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    792</span>
<span class="ansi-green-intense-fg ansi-bold">    793</span>     <span class="ansi-green-fg">def</span> reset<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> n<span class="ansi-blue-fg">,</span> has_jac<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-red-fg">IntegratorConcurrencyError</span>: Integrator `zvode` can be used to solve only a single problem at a time. If you want to integrate multiple problems, consider using a different integrator (see `ode.set_integrator`)
</pre></div></div>
</div>
</div>
<div class="section" id="Optimization-result">
<h2>Optimization result<a class="headerlink" href="#Optimization-result" title="Permalink to this headline">¶</a></h2>
opt = oct_result.optimized_objectives[0]optdyn00 = opt.propagate(tlist, propagator=propagator, rho0=rho00, e_ops=[rho00, rho01, rho10, rho11])
optdyn01 = opt.propagate(tlist, propagator=propagator, rho0=rho01, e_ops=[rho00, rho01, rho10, rho11])
optdyn10 = opt.propagate(tlist, propagator=propagator, rho0=rho10, e_ops=[rho00, rho01, rho10, rho11])
optdyn11 = opt.propagate(tlist, propagator=propagator, rho0=rho11, e_ops=[rho00, rho01, rho10, rho11])plot_population_dynamics(optdyn00, optdyn01, optdyn10, optdyn11)optimized_control = oct_result.optimized_controls[0] + 1j * oct_result.optimized_controls[1]plot_pulse(np.abs(optimized_control), tlist)</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="07_example_PE.html" class="btn btn-neutral float-right" title="Optimization towards a Perfect Entangler" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="05_example_transmon_xgate.html" class="btn btn-neutral float-left" title="Optimization of an X-Gate for a Transmon Qubit" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Michael Goerz et al.
      <span class="lastupdated">
        Last updated on Dec 14, 2019.
      </span>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
