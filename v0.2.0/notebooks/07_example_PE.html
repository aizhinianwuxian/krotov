

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Optimization towards a Perfect Entangler &mdash; Krotov 506da5b documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/version-menu.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"extensions": ["tex2jax.js"], "jax": ["input/TeX", "output/SVG"], "TeX": {"extensions": ["AMSmath.js", "AMSsymbols.js"], "Macros": {"tr": ["{\\operatorname{tr}}", 0], "diag": ["{\\operatorname{diag}}", 0], "abs": ["{\\operatorname{abs}}", 0], "pop": ["{\\operatorname{pop}}", 0], "ee": ["{\\text{e}}", 0], "ii": ["{\\text{i}}", 0], "aux": ["{\\text{aux}}", 0], "opt": ["{\\text{opt}}", 0], "tgt": ["{\\text{tgt}}", 0], "init": ["{\\text{init}}", 0], "lab": ["{\\text{lab}}", 0], "rwa": ["{\\text{rwa}}", 0], "bra": ["{\\langle#1\\vert}", 1], "ket": ["{\\vert#1\\rangle}", 1], "Bra": ["{\\left\\langle#1\\right\\vert}", 1], "Braket": ["{\\left\\langle #1\\vphantom{#2} \\mid #2\\vphantom{#1}\\right\\rangle}", 2], "ketbra": ["{\\vert#1\\rangle\\!\\langle#2\\vert}", 2], "Ket": ["{\\left\\vert#1\\right\\rangle}", 1], "mat": ["{\\mathbf{#1}}", 1], "op": ["{\\hat{#1}}", 1], "Op": ["{\\hat{#1}}", 1], "dd": ["{\\,\\text{d}}", 0], "daggered": ["{^{\\dagger}}", 0], "transposed": ["{^{\\text{T}}}", 0], "Liouville": ["{\\mathcal{L}}", 0], "DynMap": ["{\\mathcal{E}}", 0], "identity": ["{\\mathbf{1}}", 0], "Norm": ["{\\lVert#1\\rVert}", 1], "Abs": ["{\\left\\vert#1\\right\\vert}", 1], "avg": ["{\\langle#1\\rangle}", 1], "Avg": ["{\\left\\langle#1\\right\\rangle}", 1], "AbsSq": ["{\\left\\vert#1\\right\\vert^2}", 1], "Re": ["{\\operatorname{Re}}", 0], "Im": ["{\\operatorname{Im}}", 0], "Real": ["{\\mathbb{R}}", 0], "Complex": ["{\\mathbb{C}}", 0], "Integer": ["{\\mathbb{N}}", 0]}}, "tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../_static/mycss.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="How-Tos" href="../11_howto.html" />
    <link rel="prev" title="Optimization of a Dissipative Quantum Gate" href="06_example_3states.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Krotov
          

          
          </a>

          
            
            
              <div class="version">
                0.2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../01_overview.html">Krotov Python Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02_contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04_features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05_history.html">History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06_krotovs_method.html">Krotov’s Method</a></li>
<li class="toctree-l1"><a class="reference internal" href="../07_qutip_usage.html">Using Krotov with QuTiP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../09_propagation.html">Time Propagation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../10_examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01_example_simple_state_to_state.html">Optimization of a State-to-State Transfer in a Two-Level-System</a></li>
<li class="toctree-l2"><a class="reference internal" href="02_example_lambda_system_rwa_complex_pulse.html">Optimization of a state-to-state transfer in a lambda system with RWA</a></li>
<li class="toctree-l2"><a class="reference internal" href="03_example_lambda_system_rwa_non_hermitian.html">Optimization of a dissipative state-to-state transfer in a Lambda system</a></li>
<li class="toctree-l2"><a class="reference internal" href="04_example_dissipative_qubit_reset.html">Optimization of Dissipative Qubit Reset</a></li>
<li class="toctree-l2"><a class="reference internal" href="05_example_transmon_xgate.html">Optimization of an X-Gate for a Transmon Qubit</a></li>
<li class="toctree-l2"><a class="reference internal" href="06_example_3states.html">Optimization of a Dissipative Quantum Gate</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Optimization towards a Perfect Entangler</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Define-parameters">Define parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Define-the-Hamiltonian">Define the Hamiltonian</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Define-the-optimization-target">Define the optimization target</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Plot-the-guess-field">Plot the guess field</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Optimize">Optimize</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Plot-the-optimized-field">Plot the optimized field</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../11_howto.html">How-Tos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../12_other_methods.html">Other Optimization Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../99_bibliography.html">References</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../API/krotov.html">API of the Krotov package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Krotov</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          





















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../10_examples.html">Examples</a> &raquo;</li>
        
      <li>Optimization towards a Perfect Entangler</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 5ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<p><span class="raw-html"><a href="http://nbviewer.jupyter.org/github/qucontrol/krotov/blob/506da5b/docs/notebooks/07_example_PE.ipynb" target="_blank"><img alt="Render on nbviewer" src="https://img.shields.io/badge/render%20on-nbviewer-orange.svg" style="vertical-align:text-bottom"></a>&nbsp;<a href="https://mybinder.org/v2/gh/qucontrol/krotov/506da5b?filepath=docs/notebooks/07_example_PE.ipynb" target="_blank"><img alt="Launch Binder" src="https://mybinder.org/badge_logo.svg" style="vertical-align:text-bottom"></a></span></p>
<div class="section" id="Optimization-towards-a-Perfect-Entangler">
<h1>Optimization towards a Perfect Entangler<a class="headerlink" href="#Optimization-towards-a-Perfect-Entangler" title="Permalink to this headline">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># NBVAL_IGNORE_OUTPUT</span>
<span class="o">%</span><span class="k">load_ext</span> watermark
<span class="kn">import</span> <span class="nn">qutip</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">krotov</span>
<span class="kn">import</span> <span class="nn">weylchamber</span> <span class="k">as</span> <span class="nn">wc</span>
<span class="kn">from</span> <span class="nn">weylchamber.visualize</span> <span class="kn">import</span> <span class="n">WeylChamber</span>
<span class="kn">from</span> <span class="nn">weylchamber.coordinates</span> <span class="kn">import</span> <span class="n">from_magic</span>

<span class="o">%</span><span class="k">watermark</span> -v --iversions
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
numpy            1.15.4
matplotlib.pylab 1.15.4
scipy            1.2.0
krotov           0.1.0.post1+dev
matplotlib       3.0.2
qutip            4.3.1
weylchamber      0.3.0
CPython 3.6.8
IPython 7.2.0
</pre></div></div>
</div>
<p><span class="math notranslate nohighlight">\(\newcommand{tr}[0]{\operatorname{tr}} \newcommand{diag}[0]{\operatorname{diag}} \newcommand{abs}[0]{\operatorname{abs}} \newcommand{pop}[0]{\operatorname{pop}} \newcommand{aux}[0]{\text{aux}} \newcommand{opt}[0]{\text{opt}} \newcommand{tgt}[0]{\text{tgt}} \newcommand{init}[0]{\text{init}} \newcommand{lab}[0]{\text{lab}} \newcommand{rwa}[0]{\text{rwa}} \newcommand{bra}[1]{\langle#1\vert} \newcommand{ket}[1]{\vert#1\rangle} \newcommand{Bra}[1]{\left\langle#1\right\vert} \newcommand{Ket}[1]{\left\vert#1\right\rangle} \newcommand{Braket}[2]{\left\langle #1\vphantom{#2} \mid #2\vphantom{#1}\right\rangle} \newcommand{op}[1]{\hat{#1}} \newcommand{Op}[1]{\hat{#1}} \newcommand{dd}[0]{\,\text{d}} \newcommand{Liouville}[0]{\mathcal{L}} \newcommand{DynMap}[0]{\mathcal{E}} \newcommand{identity}[0]{\mathbf{1}} \newcommand{Norm}[1]{\lVert#1\rVert} \newcommand{Abs}[1]{\left\vert#1\right\vert} \newcommand{avg}[1]{\langle#1\rangle} \newcommand{Avg}[1]{\left\langle#1\right\rangle} \newcommand{AbsSq}[1]{\left\vert#1\right\vert^2} \newcommand{Re}[0]{\operatorname{Re}} \newcommand{Im}[0]{\operatorname{Im}}\)</span></p>
<p>In this example, an optimization with an “unconventional” optimization target is demonstrated. Instead of a set of initial and target states or a certain target gate that should be implemented at final time, we rather just optimize for the closest perfectly entangling gate. See the following to references for details.</p>
<ul class="simple">
<li><ol class="first upperalpha" start="16">
<li>Watts, et al., Phys. Rev.&nbsp;A 91, 062306 (2015)</li>
</ol>
</li>
<li><ol class="first upperalpha" start="13">
<li><ol class="first upperalpha" start="8">
<li>Goerz, et al., Phys. Rev.&nbsp;A 91, 062307 (2015)</li>
</ol>
</li>
</ol>
</li>
</ul>
<div class="section" id="Define-parameters">
<h2>Define parameters<a class="headerlink" href="#Define-parameters" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">w1</span> <span class="o">=</span> <span class="mf">1.1</span>  <span class="c1"># qubit 1 level splitting</span>
<span class="n">w2</span> <span class="o">=</span> <span class="mf">2.1</span>  <span class="c1"># qubit 2 level splitting</span>
<span class="n">J</span> <span class="o">=</span> <span class="mf">0.2</span>  <span class="c1"># effective qubit coupling</span>
<span class="n">u0</span> <span class="o">=</span> <span class="mf">0.3</span>  <span class="c1"># initial driving strength</span>
<span class="n">la</span> <span class="o">=</span> <span class="mf">1.1</span>  <span class="c1"># relative pulse coupling strength of second qubit</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">25.0</span>  <span class="c1"># final time</span>
<span class="n">nt</span> <span class="o">=</span> <span class="mi">250</span>  <span class="c1"># number of time steps</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Define-the-Hamiltonian">
<h2>Define the Hamiltonian<a class="headerlink" href="#Define-the-Hamiltonian" title="Permalink to this headline">¶</a></h2>
<p>The system is a two-qubit system described by the effective Hamiltonian</p>
<dl class="docutils">
<dt>:nbsphinx-math:<a href="#id1"><span class="problematic" id="id2">`</span></a>begin{equation}</dt>
<dd>op{H}(t) = - frac{omega_1}{2} op{sigma}_{z}^{(1)} - frac{omega_2}{2} op{sigma}_{z}^{(2)} + 2 J left(op{sigma}_{x}^{(1)} op{sigma}_{x}^{(2)} + op{sigma}_{y}^{(1)} op{sigma}_{y}^{(2)}right) + u(t) left(op{sigma}_{x}^{(1)} + lambda op{sigma}_{x}^{(2)}right),</dd>
</dl>
<p>end{equation}` where <span class="math notranslate nohighlight">\(\omega_1\)</span> and <span class="math notranslate nohighlight">\(\omega_2\)</span> are the energy level splitting of both qubits, respectively, <span class="math notranslate nohighlight">\(J\)</span> is the effective coupling strength and <span class="math notranslate nohighlight">\(u(t)\)</span> is the control field. <span class="math notranslate nohighlight">\(\lambda\)</span> defines the relative pulse coupling between both qubits.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">ham_and_states</span><span class="p">(</span><span class="n">w1</span><span class="o">=</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="o">=</span><span class="n">w2</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="n">J</span><span class="p">,</span> <span class="n">la</span><span class="o">=</span><span class="n">la</span><span class="p">,</span> <span class="n">u0</span><span class="o">=</span><span class="n">u0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Two qubit Hamiltonian</span>

<span class="sd">    Args:</span>
<span class="sd">        w1 (float): energy separation of the first qubit levels</span>
<span class="sd">        w2 (float): energy separation of the second qubit levels</span>
<span class="sd">        J (float): effective coupling between both qubits</span>
<span class="sd">        la (float): factor that pulse coupling strength differs for second qubit</span>
<span class="sd">        u0 (float): constant amplitude of the driving field</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># local qubit Hamiltonians</span>
    <span class="n">Hq1</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">w1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">Hq2</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">w2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

    <span class="c1"># lift Hamiltonians to joint system operators</span>
    <span class="n">H0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">Hq1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">Hq2</span><span class="p">)</span>

    <span class="c1"># define the interaction Hamiltonian</span>
    <span class="n">sig_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
    <span class="n">sig_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
    <span class="n">Hint</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">J</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">sig_x</span><span class="p">,</span> <span class="n">sig_x</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">sig_y</span><span class="p">,</span> <span class="n">sig_y</span><span class="p">))</span>
    <span class="n">H0</span> <span class="o">=</span> <span class="n">H0</span> <span class="o">+</span> <span class="n">Hint</span>

    <span class="c1"># define the drive Hamiltonian</span>
    <span class="n">H1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]),</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="n">la</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
    <span class="p">)</span>

    <span class="c1"># convert Hamiltonians to QuTiP objects</span>
    <span class="n">H0</span> <span class="o">=</span> <span class="n">qutip</span><span class="o">.</span><span class="n">Qobj</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span>
    <span class="n">H1</span> <span class="o">=</span> <span class="n">qutip</span><span class="o">.</span><span class="n">Qobj</span><span class="p">(</span><span class="n">H1</span><span class="p">)</span>

    <span class="c1"># canonical basis</span>
    <span class="n">psi_00</span> <span class="o">=</span> <span class="n">qutip</span><span class="o">.</span><span class="n">Qobj</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])))</span>
    <span class="n">psi_01</span> <span class="o">=</span> <span class="n">qutip</span><span class="o">.</span><span class="n">Qobj</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])))</span>
    <span class="n">psi_10</span> <span class="o">=</span> <span class="n">qutip</span><span class="o">.</span><span class="n">Qobj</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])))</span>
    <span class="n">psi_11</span> <span class="o">=</span> <span class="n">qutip</span><span class="o">.</span><span class="n">Qobj</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])))</span>

    <span class="c1"># define guess field</span>
    <span class="n">eps0</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">u0</span>
    <span class="k">return</span> <span class="p">([</span><span class="n">H0</span><span class="p">,</span> <span class="p">[</span><span class="n">H1</span><span class="p">,</span> <span class="n">eps0</span><span class="p">]],</span> <span class="n">psi_00</span><span class="p">,</span> <span class="n">psi_01</span><span class="p">,</span> <span class="n">psi_10</span><span class="p">,</span> <span class="n">psi_11</span><span class="p">)</span>


<span class="n">H</span><span class="p">,</span> <span class="n">psi_00</span><span class="p">,</span> <span class="n">psi_01</span><span class="p">,</span> <span class="n">psi_10</span><span class="p">,</span> <span class="n">psi_11</span> <span class="o">=</span> <span class="n">ham_and_states</span><span class="p">(</span>
    <span class="n">w1</span><span class="o">=</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="o">=</span><span class="n">w2</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="n">J</span><span class="p">,</span> <span class="n">la</span><span class="o">=</span><span class="n">la</span><span class="p">,</span> <span class="n">u0</span><span class="o">=</span><span class="n">u0</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">proj_00</span> <span class="o">=</span> <span class="n">psi_00</span> <span class="o">*</span> <span class="n">psi_00</span><span class="o">.</span><span class="n">dag</span><span class="p">()</span>
<span class="n">proj_01</span> <span class="o">=</span> <span class="n">psi_01</span> <span class="o">*</span> <span class="n">psi_01</span><span class="o">.</span><span class="n">dag</span><span class="p">()</span>
<span class="n">proj_10</span> <span class="o">=</span> <span class="n">psi_10</span> <span class="o">*</span> <span class="n">psi_10</span><span class="o">.</span><span class="n">dag</span><span class="p">()</span>
<span class="n">proj_11</span> <span class="o">=</span> <span class="n">psi_11</span> <span class="o">*</span> <span class="n">psi_11</span><span class="o">.</span><span class="n">dag</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Define-the-optimization-target">
<h2>Define the optimization target<a class="headerlink" href="#Define-the-optimization-target" title="Permalink to this headline">¶</a></h2>
<p>The time grid is given by <code class="docutils literal notranslate"><span class="pre">nt</span></code> equidistant time steps between <span class="math notranslate nohighlight">\(t=0\)</span> and <span class="math notranslate nohighlight">\(t=T\)</span>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">tlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>In order to specify the closest perfectly entangling gate as optimization target, we pass the canonical basis and specify <code class="docutils literal notranslate"><span class="pre">&quot;PE&quot;</span></code> as target gate.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">objectives</span> <span class="o">=</span> <span class="n">krotov</span><span class="o">.</span><span class="n">gate_objectives</span><span class="p">(</span>
    <span class="n">basis_states</span><span class="o">=</span><span class="p">[</span><span class="n">psi_00</span><span class="p">,</span> <span class="n">psi_01</span><span class="p">,</span> <span class="n">psi_10</span><span class="p">,</span> <span class="n">psi_11</span><span class="p">],</span> <span class="n">gate</span><span class="o">=</span><span class="s2">&quot;PE&quot;</span><span class="p">,</span> <span class="n">H</span><span class="o">=</span><span class="n">H</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Furthermore, we define the shape function <span class="math notranslate nohighlight">\(S(t)\)</span>, which we use in order to ensure a smooth switch on and off in the beginning and end.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">S</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Shape function for the field update&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">krotov</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">flattop</span><span class="p">(</span>
        <span class="n">t</span><span class="p">,</span> <span class="n">t_start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t_stop</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">t_rise</span><span class="o">=</span><span class="n">T</span> <span class="o">/</span> <span class="mi">20</span><span class="p">,</span> <span class="n">t_fall</span><span class="o">=</span><span class="n">T</span> <span class="o">/</span> <span class="mi">20</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="s1">&#39;sinsq&#39;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<p>Although the update-shape function <span class="math notranslate nohighlight">\(S(t)\)</span> does not as such have any connection to the shape of the guess field, for convenience we also adopt it here as a pulse shape.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">shape_field</span><span class="p">(</span><span class="n">eps0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Applies the shape function S(t) to the guess field&quot;&quot;&quot;</span>
    <span class="n">eps0_shaped</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">eps0</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="o">*</span> <span class="n">S</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">eps0_shaped</span>


<span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">shape_field</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>Before performing the optimization, we still have to choose <code class="docutils literal notranslate"><span class="pre">lambda_a</span></code>, which defines the control update magnitude in each iteration, and assign <span class="math notranslate nohighlight">\(S(t)\)</span> to be used as shape function.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pulse_options</span> <span class="o">=</span> <span class="p">{</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">lambda_a</span><span class="o">=</span><span class="mf">1.0e2</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">S</span><span class="p">)}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Plot-the-guess-field">
<h2>Plot the guess field<a class="headerlink" href="#Plot-the-guess-field" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">plot_pulse</span><span class="p">(</span><span class="n">pulse</span><span class="p">,</span> <span class="n">tlist</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">pulse</span><span class="p">):</span>
        <span class="n">pulse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pulse</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tlist</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tlist</span><span class="p">,</span> <span class="n">pulse</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;pulse amplitude&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The following plot shows the guess field <span class="math notranslate nohighlight">\(u_{0}(t)\)</span>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_pulse</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">tlist</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_07_example_PE_20_0.png" src="../_images/notebooks_07_example_PE_20_0.png" />
</div>
</div>
</div>
<div class="section" id="Optimize">
<h2>Optimize<a class="headerlink" href="#Optimize" title="Permalink to this headline">¶</a></h2>
<p>Our optimization target is the closest perfectly entangling gate, quantified by the perfect-entangler functional</p>
<dl class="docutils">
<dt>:nbsphinx-math:<a href="#id3"><span class="problematic" id="id4">`</span></a>begin{equation}</dt>
<dd>F_{PE} = g_3 sqrt{g_1^2 + g_2^2} - g_1,</dd>
</dl>
<p>end{equation}`</p>
<p>where <span class="math notranslate nohighlight">\(g_1, g_2, g_3\)</span> are the local invariants of the implemented gate, which uniquely identify its non-local content. As an alternative, one can also use the Weyl coordinates <span class="math notranslate nohighlight">\(c_1, c_2, c_3\)</span> to plot the gate in the Weyl chamber. The perfectly entangling gates lie within a polyhedron within the general Weyl chamber and <span class="math notranslate nohighlight">\(F_{PE}\)</span> becomes zero exactly at its boundaries.</p>
<p>In order to get feedback from the optimization, we define <code class="docutils literal notranslate"><span class="pre">print_fidelity</span></code>, which is called after each OCT step and which calculates <span class="math notranslate nohighlight">\(F_{PE}\)</span> and the gate concurrence (as an alternative measure for the entangling power of quantum gates).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">print_fidelity</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">):</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="p">[</span><span class="n">objectives</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">initial_state</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
    <span class="n">states</span> <span class="o">=</span> <span class="p">[</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;fw_states_T&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">wc</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">gate</span><span class="p">(</span><span class="n">basis</span><span class="p">,</span> <span class="n">states</span><span class="p">)</span>
    <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span> <span class="o">=</span> <span class="n">wc</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">c1c2c3</span><span class="p">(</span><span class="n">from_magic</span><span class="p">(</span><span class="n">U</span><span class="p">))</span>
    <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g3</span> <span class="o">=</span> <span class="n">wc</span><span class="o">.</span><span class="n">local_invariants</span><span class="o">.</span><span class="n">g1g2g3_from_c1c2c3</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">)</span>
    <span class="n">conc</span> <span class="o">=</span> <span class="n">wc</span><span class="o">.</span><span class="n">perfect_entanglers</span><span class="o">.</span><span class="n">concurrence</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">)</span>
    <span class="n">F_PE</span> <span class="o">=</span> <span class="n">wc</span><span class="o">.</span><span class="n">perfect_entanglers</span><span class="o">.</span><span class="n">F_PE</span><span class="p">(</span><span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g3</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;    F_PE: </span><span class="si">%f</span><span class="se">\n</span><span class="s2">    gate conc.: </span><span class="si">%f</span><span class="s2">&quot;</span>
        <span class="o">%</span> <span class="p">(</span><span class="n">F_PE</span><span class="p">,</span> <span class="n">conc</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">F_PE</span><span class="p">,</span> <span class="p">[</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>Since Krotov’s method needs to know how to calculate the so-called co-states, we must provide a callable function called <code class="docutils literal notranslate"><span class="pre">chi_constructor</span></code> to the optimization function <code class="docutils literal notranslate"><span class="pre">optimize_pulses</span></code>. This function returns</p>
<dl class="docutils">
<dt>:nbsphinx-math:<a href="#id5"><span class="problematic" id="id6">`</span></a>begin{equation}</dt>
<dd>ket{chi_{i}} = frac{partial F_{PE}}{partial bra{phi_i}} Bigg|_{ket{phi_{i}(T)}}</dd>
</dl>
<p>end{equation}`</p>
<p>for all <span class="math notranslate nohighlight">\(i\)</span> and with <span class="math notranslate nohighlight">\(\ket{\phi_i(T)}\)</span> a set of forward propagated Bell basis states. The required function is implemented in the package <code class="docutils literal notranslate"><span class="pre">weylchamber</span></code>, and is taken from there.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">chi_constructor</span> <span class="o">=</span> <span class="n">wc</span><span class="o">.</span><span class="n">perfect_entanglers</span><span class="o">.</span><span class="n">make_PE_krotov_chi_constructor</span><span class="p">(</span>
    <span class="p">[</span><span class="n">psi_00</span><span class="p">,</span> <span class="n">psi_01</span><span class="p">,</span> <span class="n">psi_10</span><span class="p">,</span> <span class="n">psi_11</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>As the perfect-entangler functional <span class="math notranslate nohighlight">\(F_{PE}\)</span> depends strongly non-linearly on the states, Krotov’s method formally requires the second-order contribution in order to guarantee monotonic convergence (see D. M. Reich, et al., J. Chem. Phys. 136, 104103 (2012) for details). In this case, the update formula can be extended and reads</p>
<p>\begin{split} <span class="math">\epsilon`^{(i+1)}(t) & = :nbsphinx-math:</span>epsilon`^{ref}(t) + <span class="math">\frac{S(t)}{\lambda_a}</span> <span class="math">\Im `:nbsphinx-math:</span>left`{ <span class="math">\sum</span>_{k=1}^{N} <span class="math">\Bigg</span><span class="math">\langle</span> <span class="math">\chi</span><em>k^{(i)}(t) :nbsphinx-math:`Bigg`:nbsphinx-math:`vert` :nbsphinx-math:`left`.:nbsphinx-math:`frac{partial Op{H}}{partial epsilon}`:nbsphinx-math:`right`:nbsphinx-math:`vert`</em>{{:nbsphinx-math:<a href="#id7"><span class="problematic" id="id8">`</span></a>scriptsize `</p>
<div class="math notranslate nohighlight">
\begin{matrix}\phi^{(i+1)}(t) \\\epsilon^{(i+1)}(t)\end{matrix}</div><p>}} <span class="math">\Bigg</span><span class="math">\vert</span> <span class="math">\phi</span>_k^{(i+1)}(t) <span class="math">\Bigg</span><span class="math">\rangle</span> \ + <span class="math">\frac{1}{2}</span> <span class="math">\sigma`(t) :nbsphinx-math:</span>Bigg`:nbsphinx-math:<cite>langle</cite> <span class="math">\Delta</span><span class="math">\phi</span><em>k(t) :nbsphinx-math:`Bigg`:nbsphinx-math:`vert` :nbsphinx-math:`left`.:nbsphinx-math:`frac{partial Op{H}}{partial epsilon}`:nbsphinx-math:`right`:nbsphinx-math:`vert`</em>{{:nbsphinx-math:<a href="#id9"><span class="problematic" id="id10">`</span></a>scriptsize `</p>
<div class="math notranslate nohighlight">
\begin{matrix}\phi^{(i+1)}(t)\\\epsilon^{(i+1)}(t)\end{matrix}</div><p>}} <span class="math">\Bigg</span><span class="math">\vert</span> <span class="math">\phi</span>_k^{(i+1)}(t) <span class="math">\Bigg</span><span class="math">\rangle</span> <span class="math">\right</span>},, \end{split}</p>
<p>where the latter term defines the second-order contribution. In order to evaluate the second-order term, we need to pass the scalar function <span class="math notranslate nohighlight">\(\sigma(t)\)</span> to the optimizer <code class="docutils literal notranslate"><span class="pre">optimize_pulses</span></code>. We take</p>
<dl class="docutils">
<dt>:nbsphinx-math:<a href="#id11"><span class="problematic" id="id12">`</span></a>begin{equation}</dt>
<dd>sigma(t) = -maxleft(varepsilon_A,2A+varepsilon_Aright)</dd>
</dl>
<p>end{equation}`</p>
<p>with <span class="math notranslate nohighlight">\(\varepsilon_A\)</span> a small non-negative number, and <span class="math notranslate nohighlight">\(A\)</span> a parameter that can be recalculated numerically after each iteration (see D. M. Reich, et al., J. Chem. Phys. 136, 104103 (2012) for details). The sigma function is expressed by subclassing <code class="docutils literal notranslate"><span class="pre">krotov.second_order.Sigma</span></code>, allowing us to connect the evaluation of the function <span class="math notranslate nohighlight">\(\sigma(t)\)</span> and the recalculation of <span class="math notranslate nohighlight">\(A\)</span>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">class</span> <span class="nc">sigma</span><span class="p">(</span><span class="n">krotov</span><span class="o">.</span><span class="n">second_order</span><span class="o">.</span><span class="n">Sigma</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">epsA</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">=</span> <span class="n">A</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epsA</span> <span class="o">=</span> <span class="n">epsA</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="n">ϵ</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsA</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span>
        <span class="k">return</span> <span class="o">-</span><span class="nb">max</span><span class="p">(</span><span class="n">ϵ</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">A</span> <span class="o">+</span> <span class="n">ϵ</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">refresh</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">forward_states</span><span class="p">,</span>
        <span class="n">forward_states0</span><span class="p">,</span>
        <span class="n">chi_states</span><span class="p">,</span>
        <span class="n">chi_norms</span><span class="p">,</span>
        <span class="n">optimized_pulses</span><span class="p">,</span>
        <span class="n">guess_pulses</span><span class="p">,</span>
        <span class="n">objectives</span><span class="p">,</span>
        <span class="n">result</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">Delta_J_T</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">info_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">result</span><span class="o">.</span><span class="n">info_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>  <span class="c1"># first iteration</span>
            <span class="n">Delta_J_T</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">=</span> <span class="n">krotov</span><span class="o">.</span><span class="n">second_order</span><span class="o">.</span><span class="n">numerical_estimate_A</span><span class="p">(</span>
            <span class="n">forward_states</span><span class="p">,</span> <span class="n">forward_states0</span><span class="p">,</span> <span class="n">chi_states</span><span class="p">,</span> <span class="n">chi_norms</span><span class="p">,</span> <span class="n">Delta_J_T</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
<p>In the following, we carry out the optimization and save the Weyl coordinates <span class="math notranslate nohighlight">\(c_1, c_2, c_3\)</span> from each iteration</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">oct_result</span> <span class="o">=</span> <span class="n">krotov</span><span class="o">.</span><span class="n">optimize_pulses</span><span class="p">(</span>
    <span class="n">objectives</span><span class="p">,</span>
    <span class="n">pulse_options</span><span class="o">=</span><span class="n">pulse_options</span><span class="p">,</span>
    <span class="n">tlist</span><span class="o">=</span><span class="n">tlist</span><span class="p">,</span>
    <span class="n">propagator</span><span class="o">=</span><span class="n">krotov</span><span class="o">.</span><span class="n">propagators</span><span class="o">.</span><span class="n">expm</span><span class="p">,</span>
    <span class="n">chi_constructor</span><span class="o">=</span><span class="n">chi_constructor</span><span class="p">,</span>
    <span class="n">info_hook</span><span class="o">=</span><span class="n">krotov</span><span class="o">.</span><span class="n">info_hooks</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
        <span class="n">krotov</span><span class="o">.</span><span class="n">info_hooks</span><span class="o">.</span><span class="n">print_debug_information</span><span class="p">,</span>
        <span class="n">print_fidelity</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">check_convergence</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">(</span><span class="n">A</span><span class="o">=</span><span class="mf">0.0</span><span class="p">),</span>
    <span class="n">iter_stop</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Iteration 0
    objectives:
        1:|(4)⟩ - {[Herm[4,4], [Herm[4,4], u1(t)]]} - &#39;PE&#39;
        2:|(4)⟩ - {[Herm[4,4], [Herm[4,4], u1(t)]]} - &#39;PE&#39;
        3:|(4)⟩ - {[Herm[4,4], [Herm[4,4], u1(t)]]} - &#39;PE&#39;
        4:|(4)⟩ - {[Herm[4,4], [Herm[4,4], u1(t)]]} - &#39;PE&#39;
    adjoint objectives:
        1:⟨(4)| - {[Herm[4,4], [Herm[4,4], u1(t)]]} - &#39;PE&#39;
        2:⟨(4)| - {[Herm[4,4], [Herm[4,4], u1(t)]]} - &#39;PE&#39;
        3:⟨(4)| - {[Herm[4,4], [Herm[4,4], u1(t)]]} - &#39;PE&#39;
        4:⟨(4)| - {[Herm[4,4], [Herm[4,4], u1(t)]]} - &#39;PE&#39;
    S(t) (ranges): [0.000000, 1.000000]
    duration: 1.3 secs (started at 2019-02-12 14:15:25)
    optimized pulses (ranges): [0.00, 0.30]
    ∫gₐ(t)dt: 0.00e+00
    λₐ: 1.00e+02
    storage (bw, fw, fw0): None, [4 * ndarray(250)] (0.5 MB), [4 * ndarray(250)] (0.5 MB)
    fw_states_T norm: 1.000000, 1.000000, 1.000000, 1.000000
    F_PE: 1.447666
    gate conc.: 0.479571
Iteration 1
    duration: 4.7 secs (started at 2019-02-12 14:15:26)
    optimized pulses (ranges): [0.00, 0.32]
    ∫gₐ(t)dt: 2.56e-03
    λₐ: 1.00e+02
    storage (bw, fw, fw0): [4 * ndarray(250)] (0.5 MB), [4 * ndarray(250)] (0.5 MB), [4 * ndarray(250)] (0.5 MB)
    fw_states_T norm: 1.000000, 1.000000, 1.000000, 1.000000
    F_PE: 1.000458
    gate conc.: 0.645400
Iteration 2
    duration: 4.8 secs (started at 2019-02-12 14:15:31)
    optimized pulses (ranges): [0.00, 0.34]
    ∫gₐ(t)dt: 2.18e-03
    λₐ: 1.00e+02
    storage (bw, fw, fw0): [4 * ndarray(250)] (0.5 MB), [4 * ndarray(250)] (0.5 MB), [4 * ndarray(250)] (0.5 MB)
    fw_states_T norm: 1.000000, 1.000000, 1.000000, 1.000000
    F_PE: 0.587432
    gate conc.: 0.782093
Iteration 3
    duration: 4.5 secs (started at 2019-02-12 14:15:36)
    optimized pulses (ranges): [0.00, 0.36]
    ∫gₐ(t)dt: 1.44e-03
    λₐ: 1.00e+02
    storage (bw, fw, fw0): [4 * ndarray(250)] (0.5 MB), [4 * ndarray(250)] (0.5 MB), [4 * ndarray(250)] (0.5 MB)
    fw_states_T norm: 1.000000, 1.000000, 1.000000, 1.000000
    F_PE: 0.309838
    gate conc.: 0.889907
Iteration 4
    duration: 4.7 secs (started at 2019-02-12 14:15:40)
    optimized pulses (ranges): [0.00, 0.37]
    ∫gₐ(t)dt: 7.71e-04
    λₐ: 1.00e+02
    storage (bw, fw, fw0): [4 * ndarray(250)] (0.5 MB), [4 * ndarray(250)] (0.5 MB), [4 * ndarray(250)] (0.5 MB)
    fw_states_T norm: 1.000000, 1.000000, 1.000000, 1.000000
    F_PE: 0.158278
    gate conc.: 0.949411
Iteration 5
    duration: 4.7 secs (started at 2019-02-12 14:15:45)
    optimized pulses (ranges): [0.00, 0.38]
    ∫gₐ(t)dt: 3.92e-04
    λₐ: 1.00e+02
    storage (bw, fw, fw0): [4 * ndarray(250)] (0.5 MB), [4 * ndarray(250)] (0.5 MB), [4 * ndarray(250)] (0.5 MB)
    fw_states_T norm: 1.000000, 1.000000, 1.000000, 1.000000
    F_PE: 0.079730
    gate conc.: 0.979050
Iteration 6
    duration: 4.6 secs (started at 2019-02-12 14:15:49)
    optimized pulses (ranges): [0.00, 0.38]
    ∫gₐ(t)dt: 2.07e-04
    λₐ: 1.00e+02
    storage (bw, fw, fw0): [4 * ndarray(250)] (0.5 MB), [4 * ndarray(250)] (0.5 MB), [4 * ndarray(250)] (0.5 MB)
    fw_states_T norm: 1.000000, 1.000000, 1.000000, 1.000000
    F_PE: 0.037817
    gate conc.: 0.992901
Iteration 7
    duration: 4.6 secs (started at 2019-02-12 14:15:54)
    optimized pulses (ranges): [0.00, 0.39]
    ∫gₐ(t)dt: 1.16e-04
    λₐ: 1.00e+02
    storage (bw, fw, fw0): [4 * ndarray(250)] (0.5 MB), [4 * ndarray(250)] (0.5 MB), [4 * ndarray(250)] (0.5 MB)
    fw_states_T norm: 1.000000, 1.000000, 1.000000, 1.000000
    F_PE: 0.014284
    gate conc.: 0.998580
Iteration 8
    duration: 4.7 secs (started at 2019-02-12 14:15:59)
    optimized pulses (ranges): [0.00, 0.39]
    ∫gₐ(t)dt: 6.83e-05
    λₐ: 1.00e+02
    storage (bw, fw, fw0): [4 * ndarray(250)] (0.5 MB), [4 * ndarray(250)] (0.5 MB), [4 * ndarray(250)] (0.5 MB)
    fw_states_T norm: 1.000000, 1.000000, 1.000000, 1.000000
    F_PE: 0.000359
    gate conc.: 0.999999
</pre></div></div>
</div>
<p>The following plots the path of the quantum gate within the Weyl chamber as a function of the iterations. As can be seen, the optimization drives the implemented gate towards the closest boundary of the polyhedron of perfect entanglers.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">w</span> <span class="o">=</span> <span class="n">WeylChamber</span><span class="p">()</span>
<span class="n">c1c2c3</span> <span class="o">=</span> <span class="p">[</span><span class="n">oct_result</span><span class="o">.</span><span class="n">info_vals</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">oct_result</span><span class="o">.</span><span class="n">iters</span><span class="p">))]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">oct_result</span><span class="o">.</span><span class="n">iters</span><span class="p">)):</span>
    <span class="n">w</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">c1c2c3</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">c1c2c3</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">c1c2c3</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
<span class="n">w</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_07_example_PE_30_0.png" src="../_images/notebooks_07_example_PE_30_0.png" />
</div>
</div>
</div>
<div class="section" id="Plot-the-optimized-field">
<h2>Plot the optimized field<a class="headerlink" href="#Plot-the-optimized-field" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_pulse</span><span class="p">(</span><span class="n">oct_result</span><span class="o">.</span><span class="n">optimized_controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tlist</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_07_example_PE_32_0.png" src="../_images/notebooks_07_example_PE_32_0.png" />
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../11_howto.html" class="btn btn-neutral float-right" title="How-Tos" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="06_example_3states.html" class="btn btn-neutral float-left" title="Optimization of a Dissipative Quantum Gate" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Michael Goerz et al.
      <span class="lastupdated">
        Last updated on Dec 14, 2019.
      </span>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
